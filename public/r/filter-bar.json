{
  "$schema": "https://ui.shadcn.com/schema/registry-item.json",
  "name": "filter-bar",
  "title": "Filter Bar",
  "description": "A filter chips component with command-based field picker, supporting option lists, date ranges, and text search filters.",
  "dependencies": [
    "date-fns"
  ],
  "registryDependencies": [
    "button",
    "calendar",
    "checkbox",
    "command",
    "input",
    "popover"
  ],
  "files": [
    {
      "path": "registry/default/filter-bar/filter-bar.tsx",
      "content": "\"use client\"\n\nimport * as React from \"react\"\nimport { format } from \"date-fns\"\nimport {\n  CalendarIcon,\n  Check,\n  ListFilter,\n  Plus,\n  Search,\n  Type,\n  X,\n} from \"lucide-react\"\nimport type { LucideIcon } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\nimport { Calendar } from \"@/components/ui/calendar\"\nimport { Checkbox } from \"@/components/ui/checkbox\"\nimport {\n  Command,\n  CommandEmpty,\n  CommandGroup,\n  CommandInput,\n  CommandItem,\n  CommandList,\n} from \"@/components/ui/command\"\nimport { Input } from \"@/components/ui/input\"\nimport {\n  Popover,\n  PopoverContent,\n  PopoverTrigger,\n} from \"@/components/ui/popover\"\n\n// ---------------------------------------------------------------------------\n// Types\n// ---------------------------------------------------------------------------\n\nexport interface FilterOption {\n  label: string\n  value: string\n}\n\nexport interface OptionFilterField {\n  type: \"option\"\n  key: string\n  label: string\n  icon?: LucideIcon\n  options: FilterOption[]\n  multiple?: boolean\n}\n\nexport interface DateFilterField {\n  type: \"date\" | \"date-range\"\n  key: string\n  label: string\n  icon?: LucideIcon\n  minDate?: Date\n  maxDate?: Date\n}\n\nexport interface TextFilterField {\n  type: \"text\"\n  key: string\n  label: string\n  icon?: LucideIcon\n  placeholder?: string\n}\n\nexport type FilterField = OptionFilterField | DateFilterField | TextFilterField\n\nexport type ActiveFilter =\n  | { key: string; type: \"option\"; values: string[] }\n  | { key: string; type: \"date\"; value: Date }\n  | { key: string; type: \"date-range\"; start: Date; end: Date }\n  | { key: string; type: \"text\"; value: string }\n\nexport interface FilterBarProps {\n  fields: FilterField[]\n  filters: ActiveFilter[]\n  onChange: (filters: ActiveFilter[]) => void\n  className?: string\n}\n\n// ---------------------------------------------------------------------------\n// Helpers\n// ---------------------------------------------------------------------------\n\nfunction fieldIcon(field: FilterField): LucideIcon {\n  if (field.icon) return field.icon\n  switch (field.type) {\n    case \"option\":\n      return ListFilter\n    case \"date\":\n    case \"date-range\":\n      return CalendarIcon\n    case \"text\":\n      return Type\n  }\n}\n\nfunction formatFilterValue(filter: ActiveFilter, field: FilterField): string {\n  switch (filter.type) {\n    case \"option\": {\n      const optField = field as OptionFilterField\n      const labels = filter.values\n        .map((v) => optField.options.find((o) => o.value === v)?.label ?? v)\n      if (labels.length <= 2) return labels.join(\", \")\n      return `${labels[0]} +${labels.length - 1} more`\n    }\n    case \"date\":\n      return format(filter.value, \"MMM d, yyyy\")\n    case \"date-range\":\n      return `${format(filter.start, \"MMM d\")} - ${format(filter.end, \"MMM d, yyyy\")}`\n    case \"text\":\n      return filter.value\n  }\n}\n\n// ---------------------------------------------------------------------------\n// FieldPicker – step 1 of \"Add filter\"\n// ---------------------------------------------------------------------------\n\nfunction FieldPicker({\n  fields,\n  activeKeys,\n  onSelect,\n}: {\n  fields: FilterField[]\n  activeKeys: Set<string>\n  onSelect: (field: FilterField) => void\n}) {\n  const available = fields.filter((f) => !activeKeys.has(f.key))\n\n  return (\n    <Command>\n      <CommandInput placeholder=\"Search filters...\" />\n      <CommandList>\n        <CommandEmpty>No filters available.</CommandEmpty>\n        <CommandGroup>\n          {available.map((field) => {\n            const Icon = fieldIcon(field)\n            return (\n              <CommandItem\n                key={field.key}\n                value={field.label}\n                onSelect={() => onSelect(field)}\n              >\n                <Icon className=\"mr-2 h-4 w-4 text-muted-foreground\" />\n                {field.label}\n              </CommandItem>\n            )\n          })}\n        </CommandGroup>\n      </CommandList>\n    </Command>\n  )\n}\n\n// ---------------------------------------------------------------------------\n// OptionValueEditor – step 2 for \"option\" fields\n// ---------------------------------------------------------------------------\n\nfunction OptionValueEditor({\n  field,\n  initial,\n  onApply,\n}: {\n  field: OptionFilterField\n  initial: string[]\n  onApply: (values: string[]) => void\n}) {\n  const [selected, setSelected] = React.useState<string[]>(initial)\n  const isMulti = field.multiple !== false\n\n  const toggle = (value: string) => {\n    if (isMulti) {\n      setSelected((prev) =>\n        prev.includes(value)\n          ? prev.filter((v) => v !== value)\n          : [...prev, value]\n      )\n    } else {\n      onApply([value])\n    }\n  }\n\n  return (\n    <div className=\"flex flex-col\">\n      <Command>\n        <CommandInput placeholder={`Search ${field.label.toLowerCase()}...`} />\n        <CommandList>\n          <CommandEmpty>No results.</CommandEmpty>\n          <CommandGroup>\n            {field.options.map((opt) => {\n              const active = selected.includes(opt.value)\n              return (\n                <CommandItem\n                  key={opt.value}\n                  value={opt.label}\n                  onSelect={() => toggle(opt.value)}\n                >\n                  {isMulti ? (\n                    <Checkbox\n                      checked={active}\n                      className=\"mr-2 pointer-events-none\"\n                      tabIndex={-1}\n                    />\n                  ) : (\n                    <Check\n                      className={cn(\n                        \"mr-2 h-4 w-4\",\n                        active ? \"opacity-100\" : \"opacity-0\"\n                      )}\n                    />\n                  )}\n                  {opt.label}\n                </CommandItem>\n              )\n            })}\n          </CommandGroup>\n        </CommandList>\n      </Command>\n      {isMulti && (\n        <div className=\"border-t p-2\">\n          <Button\n            size=\"sm\"\n            className=\"w-full\"\n            disabled={selected.length === 0}\n            onClick={() => onApply(selected)}\n          >\n            Apply\n          </Button>\n        </div>\n      )}\n    </div>\n  )\n}\n\n// ---------------------------------------------------------------------------\n// DateValueEditor – step 2 for \"date\" fields\n// ---------------------------------------------------------------------------\n\nfunction DateValueEditor({\n  field,\n  initial,\n  onApply,\n}: {\n  field: DateFilterField\n  initial: Date | undefined\n  onApply: (date: Date) => void\n}) {\n  const disabled = (date: Date) => {\n    if (field.minDate && date < field.minDate) return true\n    if (field.maxDate && date > field.maxDate) return true\n    return false\n  }\n\n  return (\n    <Calendar\n      mode=\"single\"\n      selected={initial}\n      onSelect={(date) => date && onApply(date)}\n      disabled={disabled}\n      initialFocus\n    />\n  )\n}\n\n// ---------------------------------------------------------------------------\n// DateRangeValueEditor – step 2 for \"date-range\" fields\n// ---------------------------------------------------------------------------\n\nfunction DateRangeValueEditor({\n  field,\n  initialStart,\n  initialEnd,\n  onApply,\n}: {\n  field: DateFilterField\n  initialStart: Date | undefined\n  initialEnd: Date | undefined\n  onApply: (start: Date, end: Date) => void\n}) {\n  const [start, setStart] = React.useState<Date | undefined>(initialStart)\n  const [end, setEnd] = React.useState<Date | undefined>(initialEnd)\n  const [selectingEnd, setSelectingEnd] = React.useState(false)\n\n  const disabled = (date: Date) => {\n    if (field.minDate && date < field.minDate) return true\n    if (field.maxDate && date > field.maxDate) return true\n    if (selectingEnd && start && date < start) return true\n    return false\n  }\n\n  const handleSelect = (date: Date | undefined) => {\n    if (!date) return\n    if (!selectingEnd) {\n      setStart(date)\n      setEnd(undefined)\n      setSelectingEnd(true)\n    } else {\n      setEnd(date)\n      setSelectingEnd(false)\n      if (start) onApply(start, date)\n    }\n  }\n\n  return (\n    <div className=\"flex flex-col\">\n      <div className=\"px-3 py-2 text-xs text-muted-foreground font-medium\">\n        {!selectingEnd ? \"Select start date\" : \"Select end date\"}\n      </div>\n      <Calendar\n        mode=\"single\"\n        selected={selectingEnd ? end : start}\n        onSelect={handleSelect}\n        disabled={disabled}\n        initialFocus\n      />\n      {start && end && (\n        <div className=\"border-t px-3 py-2 text-xs text-muted-foreground\">\n          {format(start, \"MMM d, yyyy\")} - {format(end, \"MMM d, yyyy\")}\n        </div>\n      )}\n    </div>\n  )\n}\n\n// ---------------------------------------------------------------------------\n// TextValueEditor – step 2 for \"text\" fields\n// ---------------------------------------------------------------------------\n\nfunction TextValueEditor({\n  field,\n  initial,\n  onApply,\n}: {\n  field: TextFilterField\n  initial: string\n  onApply: (value: string) => void\n}) {\n  const [value, setValue] = React.useState(initial)\n\n  const handleSubmit = () => {\n    const trimmed = value.trim()\n    if (trimmed) onApply(trimmed)\n  }\n\n  return (\n    <div className=\"flex flex-col gap-2 p-3\">\n      <div className=\"flex items-center gap-2\">\n        <Search className=\"h-4 w-4 text-muted-foreground shrink-0\" />\n        <Input\n          placeholder={field.placeholder ?? `Filter by ${field.label.toLowerCase()}...`}\n          value={value}\n          onChange={(e) => setValue(e.target.value)}\n          onKeyDown={(e) => {\n            if (e.key === \"Enter\") handleSubmit()\n          }}\n          autoFocus\n        />\n      </div>\n      <Button size=\"sm\" disabled={!value.trim()} onClick={handleSubmit}>\n        Apply\n      </Button>\n    </div>\n  )\n}\n\n// ---------------------------------------------------------------------------\n// FilterChip – an active filter rendered as a clickable, removable chip\n// ---------------------------------------------------------------------------\n\nfunction FilterChip({\n  field,\n  filter,\n  onUpdate,\n  onRemove,\n}: {\n  field: FilterField\n  filter: ActiveFilter\n  onUpdate: (filter: ActiveFilter) => void\n  onRemove: () => void\n}) {\n  const [open, setOpen] = React.useState(false)\n  const Icon = fieldIcon(field)\n\n  const handleApply = (newFilter: ActiveFilter) => {\n    onUpdate(newFilter)\n    setOpen(false)\n  }\n\n  return (\n    <Popover open={open} onOpenChange={setOpen}>\n      <PopoverTrigger asChild>\n        <button\n          type=\"button\"\n          className={cn(\n            \"inline-flex items-center gap-1.5 rounded-md border bg-background px-2.5 py-1 text-sm transition-colors\",\n            \"hover:bg-accent hover:text-accent-foreground\",\n            \"focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2\",\n            open && \"bg-accent text-accent-foreground\"\n          )}\n        >\n          <Icon className=\"h-3.5 w-3.5 text-muted-foreground shrink-0\" />\n          <span className=\"font-medium\">{field.label}:</span>\n          <span className=\"text-muted-foreground max-w-[150px] truncate\">\n            {formatFilterValue(filter, field)}\n          </span>\n          <span\n            role=\"button\"\n            tabIndex={0}\n            className=\"ml-0.5 rounded-full p-0.5 hover:bg-muted-foreground/20\"\n            onClick={(e) => {\n              e.stopPropagation()\n              onRemove()\n            }}\n            onKeyDown={(e) => {\n              if (e.key === \"Enter\") {\n                e.stopPropagation()\n                onRemove()\n              }\n            }}\n          >\n            <X className=\"h-3 w-3\" />\n          </span>\n        </button>\n      </PopoverTrigger>\n      <PopoverContent className=\"w-auto p-0\" align=\"start\">\n        <ValueEditor\n          field={field}\n          filter={filter}\n          onApply={handleApply}\n        />\n      </PopoverContent>\n    </Popover>\n  )\n}\n\n// ---------------------------------------------------------------------------\n// ValueEditor – routes to the correct editor based on field type\n// ---------------------------------------------------------------------------\n\nfunction ValueEditor({\n  field,\n  filter,\n  onApply,\n}: {\n  field: FilterField\n  filter: ActiveFilter | null\n  onApply: (filter: ActiveFilter) => void\n}) {\n  switch (field.type) {\n    case \"option\":\n      return (\n        <OptionValueEditor\n          field={field}\n          initial={filter?.type === \"option\" ? filter.values : []}\n          onApply={(values) =>\n            onApply({ key: field.key, type: \"option\", values })\n          }\n        />\n      )\n    case \"date\":\n      return (\n        <DateValueEditor\n          field={field as DateFilterField}\n          initial={filter?.type === \"date\" ? filter.value : undefined}\n          onApply={(date) =>\n            onApply({ key: field.key, type: \"date\", value: date })\n          }\n        />\n      )\n    case \"date-range\":\n      return (\n        <DateRangeValueEditor\n          field={field as DateFilterField}\n          initialStart={\n            filter?.type === \"date-range\" ? filter.start : undefined\n          }\n          initialEnd={\n            filter?.type === \"date-range\" ? filter.end : undefined\n          }\n          onApply={(start, end) =>\n            onApply({ key: field.key, type: \"date-range\", start, end })\n          }\n        />\n      )\n    case \"text\":\n      return (\n        <TextValueEditor\n          field={field as TextFilterField}\n          initial={filter?.type === \"text\" ? filter.value : \"\"}\n          onApply={(value) =>\n            onApply({ key: field.key, type: \"text\", value })\n          }\n        />\n      )\n  }\n}\n\n// ---------------------------------------------------------------------------\n// AddFilterButton – the \"+ Add filter\" popover with two-step flow\n// ---------------------------------------------------------------------------\n\nfunction AddFilterButton({\n  fields,\n  activeKeys,\n  onAdd,\n}: {\n  fields: FilterField[]\n  activeKeys: Set<string>\n  onAdd: (filter: ActiveFilter) => void\n}) {\n  const [open, setOpen] = React.useState(false)\n  const [selectedField, setSelectedField] = React.useState<FilterField | null>(\n    null\n  )\n\n  const allUsed = fields.every((f) => activeKeys.has(f.key))\n\n  const handleFieldSelect = (field: FilterField) => {\n    setSelectedField(field)\n  }\n\n  const handleApply = (filter: ActiveFilter) => {\n    onAdd(filter)\n    setSelectedField(null)\n    setOpen(false)\n  }\n\n  return (\n    <Popover\n      open={open}\n      onOpenChange={(o) => {\n        setOpen(o)\n        if (!o) setSelectedField(null)\n      }}\n    >\n      <PopoverTrigger asChild>\n        <Button\n          variant=\"outline\"\n          size=\"sm\"\n          className=\"border-dashed\"\n          disabled={allUsed}\n        >\n          <Plus className=\"mr-1 h-3.5 w-3.5\" />\n          Add filter\n        </Button>\n      </PopoverTrigger>\n      <PopoverContent className=\"w-auto p-0\" align=\"start\">\n        {selectedField ? (\n          <ValueEditor\n            field={selectedField}\n            filter={null}\n            onApply={handleApply}\n          />\n        ) : (\n          <FieldPicker\n            fields={fields}\n            activeKeys={activeKeys}\n            onSelect={handleFieldSelect}\n          />\n        )}\n      </PopoverContent>\n    </Popover>\n  )\n}\n\n// ---------------------------------------------------------------------------\n// FilterBar – main exported component\n// ---------------------------------------------------------------------------\n\nfunction FilterBar({ fields, filters, onChange, className }: FilterBarProps) {\n  const activeKeys = new Set(filters.map((f) => f.key))\n\n  const handleUpdate = (index: number, updated: ActiveFilter) => {\n    const next = [...filters]\n    next[index] = updated\n    onChange(next)\n  }\n\n  const handleRemove = (index: number) => {\n    onChange(filters.filter((_, i) => i !== index))\n  }\n\n  const handleAdd = (filter: ActiveFilter) => {\n    onChange([...filters, filter])\n  }\n\n  const handleClearAll = () => {\n    onChange([])\n  }\n\n  return (\n    <div className={cn(\"flex flex-wrap items-center gap-2\", className)}>\n      {filters.map((filter, index) => {\n        const field = fields.find((f) => f.key === filter.key)\n        if (!field) return null\n        return (\n          <FilterChip\n            key={filter.key}\n            field={field}\n            filter={filter}\n            onUpdate={(updated) => handleUpdate(index, updated)}\n            onRemove={() => handleRemove(index)}\n          />\n        )\n      })}\n      <AddFilterButton\n        fields={fields}\n        activeKeys={activeKeys}\n        onAdd={handleAdd}\n      />\n      {filters.length >= 2 && (\n        <button\n          type=\"button\"\n          className=\"text-sm text-muted-foreground hover:text-foreground transition-colors\"\n          onClick={handleClearAll}\n        >\n          Clear all\n        </button>\n      )}\n    </div>\n  )\n}\n\nexport { FilterBar }\n",
      "type": "registry:ui"
    }
  ],
  "type": "registry:ui"
}