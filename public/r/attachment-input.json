{
  "$schema": "https://ui.shadcn.com/schema/registry-item.json",
  "name": "attachment-input",
  "title": "Attachment Input",
  "description": "A file attachment input with dropzone and compact variants, supporting single and multiple file modes with validation.",
  "dependencies": [],
  "registryDependencies": [],
  "files": [
    {
      "path": "registry/default/attachment-input/attachment-input.tsx",
      "content": "\"use client\"\n\nimport * as React from \"react\"\nimport {\n  File as FileIcon,\n  FileImage,\n  FileText,\n  FileSpreadsheet,\n  FileArchive,\n  Paperclip,\n  Upload,\n  X,\n} from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\n// ---------------------------------------------------------------------------\n// Types\n// ---------------------------------------------------------------------------\n\nexport interface AttachmentFile {\n  id?: string\n  name: string\n  size: number\n  type: string\n  url?: string\n  file?: File\n}\n\ninterface AttachmentInputBaseProps {\n  variant?: \"dropzone\" | \"compact\"\n  accept?: string\n  maxSize?: number\n  disabled?: boolean\n  className?: string\n}\n\ninterface SingleAttachmentInputProps extends AttachmentInputBaseProps {\n  mode: \"single\"\n  value: AttachmentFile | null\n  onChange: (file: AttachmentFile | null) => void\n}\n\ninterface MultipleAttachmentInputProps extends AttachmentInputBaseProps {\n  mode: \"multiple\"\n  value: AttachmentFile[]\n  onChange: (files: AttachmentFile[]) => void\n  maxFiles?: number\n}\n\nexport type AttachmentInputProps =\n  | SingleAttachmentInputProps\n  | MultipleAttachmentInputProps\n\n// ---------------------------------------------------------------------------\n// Helpers\n// ---------------------------------------------------------------------------\n\nfunction formatFileSize(bytes: number): string {\n  if (bytes === 0) return \"0 B\"\n  const units = [\"B\", \"KB\", \"MB\", \"GB\"]\n  const i = Math.floor(Math.log(bytes) / Math.log(1024))\n  const size = bytes / Math.pow(1024, i)\n  return `${size.toFixed(i === 0 ? 0 : 1)} ${units[i]}`\n}\n\nfunction getFileIcon(type: string) {\n  if (type.startsWith(\"image/\")) return FileImage\n  if (type === \"application/pdf\" || type.startsWith(\"text/\")) return FileText\n  if (\n    type.includes(\"spreadsheet\") ||\n    type.includes(\"excel\") ||\n    type === \"text/csv\"\n  )\n    return FileSpreadsheet\n  if (type.includes(\"zip\") || type.includes(\"archive\") || type.includes(\"tar\"))\n    return FileArchive\n  return FileIcon\n}\n\nfunction generateAcceptLabel(accept: string | undefined): string | null {\n  if (!accept) return null\n  const parts = accept.split(\",\").map((s) => s.trim())\n  const labels: string[] = []\n  for (const part of parts) {\n    if (part.startsWith(\".\")) {\n      labels.push(part.slice(1).toUpperCase())\n    } else if (part === \"image/*\") {\n      labels.push(\"Images\")\n    } else if (part === \"video/*\") {\n      labels.push(\"Videos\")\n    } else if (part === \"audio/*\") {\n      labels.push(\"Audio\")\n    } else if (part === \"application/pdf\") {\n      labels.push(\"PDF\")\n    } else {\n      const ext = part.split(\"/\")[1]\n      if (ext && ext !== \"*\") labels.push(ext.toUpperCase())\n    }\n  }\n  return labels.length > 0 ? labels.join(\", \") : null\n}\n\nfunction isDuplicate(file: File, existing: AttachmentFile[]): boolean {\n  return existing.some((f) => f.name === file.name && f.size === file.size)\n}\n\nfunction fileToAttachment(file: File): AttachmentFile {\n  return {\n    name: file.name,\n    size: file.size,\n    type: file.type,\n    file,\n  }\n}\n\n// ---------------------------------------------------------------------------\n// FileListItem\n// ---------------------------------------------------------------------------\n\nfunction FileListItem({\n  attachment,\n  onRemove,\n  disabled,\n}: {\n  attachment: AttachmentFile\n  onRemove: () => void\n  disabled?: boolean\n}) {\n  const Icon = getFileIcon(attachment.type)\n\n  return (\n    <div\n      className={cn(\n        \"group flex items-center gap-3 rounded-md border border-border bg-muted/50 px-3 py-2 text-sm transition-colors\",\n        \"dark:bg-muted/30\"\n      )}\n    >\n      <Icon className=\"h-4 w-4 shrink-0 text-muted-foreground\" />\n      <span className=\"min-w-0 flex-1 truncate text-foreground\">\n        {attachment.name}\n      </span>\n      <span className=\"shrink-0 text-xs text-muted-foreground\">\n        {formatFileSize(attachment.size)}\n      </span>\n      {!disabled && (\n        <button\n          type=\"button\"\n          className={cn(\n            \"shrink-0 rounded-full p-0.5 text-muted-foreground transition-colors\",\n            \"hover:bg-muted-foreground/20 hover:text-foreground\",\n            \"focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2\"\n          )}\n          onClick={onRemove}\n          aria-label={`Remove ${attachment.name}`}\n        >\n          <X className=\"h-3.5 w-3.5\" />\n        </button>\n      )}\n    </div>\n  )\n}\n\n// ---------------------------------------------------------------------------\n// CompactFileChip\n// ---------------------------------------------------------------------------\n\nfunction CompactFileChip({\n  attachment,\n  onRemove,\n  disabled,\n}: {\n  attachment: AttachmentFile\n  onRemove: () => void\n  disabled?: boolean\n}) {\n  const Icon = getFileIcon(attachment.type)\n\n  return (\n    <span\n      className={cn(\n        \"inline-flex items-center gap-1 rounded-md border border-border bg-muted/60 px-2 py-0.5 text-xs text-foreground\",\n        \"dark:bg-muted/40\"\n      )}\n    >\n      <Icon className=\"h-3 w-3 shrink-0 text-muted-foreground\" />\n      <span className=\"max-w-[120px] truncate\">{attachment.name}</span>\n      {!disabled && (\n        <button\n          type=\"button\"\n          className={cn(\n            \"ml-0.5 shrink-0 rounded-full p-0.5 text-muted-foreground transition-colors\",\n            \"hover:bg-muted-foreground/20 hover:text-foreground\",\n            \"focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2\"\n          )}\n          onClick={(e) => {\n            e.stopPropagation()\n            onRemove()\n          }}\n          aria-label={`Remove ${attachment.name}`}\n        >\n          <X className=\"h-3 w-3\" />\n        </button>\n      )}\n    </span>\n  )\n}\n\n// ---------------------------------------------------------------------------\n// DropzoneArea\n// ---------------------------------------------------------------------------\n\nfunction DropzoneArea({\n  accept,\n  maxSize,\n  disabled,\n  hasFiles,\n  fileCount,\n  maxFiles,\n  onClick,\n  onDrop,\n}: {\n  accept?: string\n  maxSize?: number\n  disabled?: boolean\n  hasFiles: boolean\n  fileCount: number\n  maxFiles?: number\n  onClick: () => void\n  onDrop: (files: FileList) => void\n}) {\n  const [isDragOver, setIsDragOver] = React.useState(false)\n\n  const acceptLabel = generateAcceptLabel(accept)\n  const sizeLabel = maxSize ? formatFileSize(maxSize) : null\n  const atLimit = maxFiles !== undefined && fileCount >= maxFiles\n\n  const handleDragOver = (e: React.DragEvent) => {\n    e.preventDefault()\n    e.stopPropagation()\n    if (!disabled && !atLimit) setIsDragOver(true)\n  }\n\n  const handleDragLeave = (e: React.DragEvent) => {\n    e.preventDefault()\n    e.stopPropagation()\n    setIsDragOver(false)\n  }\n\n  const handleDrop = (e: React.DragEvent) => {\n    e.preventDefault()\n    e.stopPropagation()\n    setIsDragOver(false)\n    if (!disabled && !atLimit && e.dataTransfer.files.length > 0) {\n      onDrop(e.dataTransfer.files)\n    }\n  }\n\n  const hintParts: string[] = []\n  if (acceptLabel) hintParts.push(acceptLabel)\n  if (sizeLabel) hintParts.push(`up to ${sizeLabel}`)\n  const hint = hintParts.length > 0 ? hintParts.join(\" - \") : null\n\n  return (\n    <button\n      type=\"button\"\n      disabled={disabled || atLimit}\n      onClick={onClick}\n      onDragOver={handleDragOver}\n      onDragLeave={handleDragLeave}\n      onDrop={handleDrop}\n      className={cn(\n        \"flex w-full flex-col items-center justify-center gap-2 rounded-md border-2 border-dashed px-6 py-8 text-center transition-all duration-150 ease-out\",\n        \"border-muted-foreground/25 bg-muted/30\",\n        \"hover:border-muted-foreground/40 hover:bg-muted/50\",\n        \"focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2\",\n        \"dark:bg-muted/10 dark:hover:bg-muted/20\",\n        isDragOver &&\n          \"border-primary bg-primary/5 dark:bg-primary/10\",\n        (disabled || atLimit) &&\n          \"cursor-not-allowed opacity-40 hover:border-muted-foreground/25 hover:bg-muted/30\"\n      )}\n    >\n      <Upload\n        className={cn(\n          \"h-8 w-8 text-muted-foreground transition-colors\",\n          isDragOver && \"text-primary\"\n        )}\n      />\n      <div className=\"space-y-1\">\n        <p className=\"text-sm font-medium text-foreground\">\n          {atLimit\n            ? \"File limit reached\"\n            : hasFiles\n              ? \"Drop more files or click to add\"\n              : \"Drag & drop files here, or click to browse\"}\n        </p>\n        {hint && (\n          <p className=\"text-xs text-muted-foreground\">{hint}</p>\n        )}\n        {maxFiles !== undefined && (\n          <p className=\"text-xs text-muted-foreground\">\n            {fileCount} of {maxFiles} files\n          </p>\n        )}\n      </div>\n    </button>\n  )\n}\n\n// ---------------------------------------------------------------------------\n// CompactTrigger\n// ---------------------------------------------------------------------------\n\nfunction CompactTrigger({\n  disabled,\n  atLimit,\n  onClick,\n}: {\n  disabled?: boolean\n  atLimit: boolean\n  onClick: () => void\n}) {\n  return (\n    <button\n      type=\"button\"\n      disabled={disabled || atLimit}\n      onClick={onClick}\n      className={cn(\n        \"flex h-9 w-full items-center gap-2 rounded-md border border-input bg-background px-3 text-sm shadow-[0_1px_0_rgba(0,0,0,0.04)] transition-all duration-150 ease-out\",\n        \"text-muted-foreground\",\n        \"hover:bg-muted hover:text-foreground hover:shadow-[0_1px_2px_rgba(0,0,0,0.06)]\",\n        \"focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2\",\n        (disabled || atLimit) &&\n          \"cursor-not-allowed opacity-40 hover:bg-background hover:text-muted-foreground hover:shadow-[0_1px_0_rgba(0,0,0,0.04)]\"\n      )}\n    >\n      <Paperclip className=\"h-4 w-4 shrink-0\" />\n      <span>{atLimit ? \"File limit reached\" : \"Attach files...\"}</span>\n    </button>\n  )\n}\n\n// ---------------------------------------------------------------------------\n// ErrorMessage\n// ---------------------------------------------------------------------------\n\nfunction ErrorMessage({\n  message,\n  onDismiss,\n}: {\n  message: string\n  onDismiss: () => void\n}) {\n  React.useEffect(() => {\n    const timer = setTimeout(onDismiss, 5000)\n    return () => clearTimeout(timer)\n  }, [onDismiss])\n\n  return (\n    <p className=\"text-xs text-destructive\" role=\"alert\">\n      {message}\n    </p>\n  )\n}\n\n// ---------------------------------------------------------------------------\n// AttachmentInput\n// ---------------------------------------------------------------------------\n\nfunction AttachmentInput(props: AttachmentInputProps) {\n  const {\n    variant = \"dropzone\",\n    accept,\n    maxSize,\n    disabled = false,\n    className,\n    mode,\n  } = props\n\n  const inputRef = React.useRef<HTMLInputElement>(null)\n  const [error, setError] = React.useState<string | null>(null)\n\n  const files: AttachmentFile[] =\n    mode === \"single\"\n      ? props.value\n        ? [props.value]\n        : []\n      : props.value\n\n  const maxFiles = mode === \"multiple\" ? props.maxFiles : undefined\n  const atLimit =\n    mode === \"multiple\" && maxFiles !== undefined && files.length >= maxFiles\n\n  const clearError = React.useCallback(() => setError(null), [])\n\n  const handleFiles = React.useCallback(\n    (fileList: FileList) => {\n      const incoming = Array.from(fileList)\n      const validated: AttachmentFile[] = []\n\n      for (const file of incoming) {\n        if (maxSize && file.size > maxSize) {\n          setError(\n            `File exceeds maximum size of ${formatFileSize(maxSize)}`\n          )\n          continue\n        }\n\n        if (mode === \"multiple\" && isDuplicate(file, files)) {\n          continue\n        }\n\n        validated.push(fileToAttachment(file))\n      }\n\n      if (validated.length === 0) return\n\n      if (mode === \"single\") {\n        props.onChange(validated[0])\n      } else {\n        const remaining =\n          maxFiles !== undefined\n            ? maxFiles - files.length\n            : validated.length\n        if (remaining <= 0) {\n          setError(`Maximum of ${maxFiles} files allowed`)\n          return\n        }\n        const toAdd = validated.slice(0, remaining)\n        if (validated.length > remaining) {\n          setError(`Maximum of ${maxFiles} files allowed`)\n        }\n        props.onChange([...files, ...toAdd])\n      }\n\n      if (inputRef.current) {\n        inputRef.current.value = \"\"\n      }\n    },\n    [mode, files, maxSize, maxFiles, props.onChange]\n  )\n\n  const handleRemove = React.useCallback(\n    (index: number) => {\n      if (mode === \"single\") {\n        props.onChange(null)\n      } else {\n        props.onChange(files.filter((_, i) => i !== index))\n      }\n    },\n    [mode, files, props.onChange]\n  )\n\n  const openPicker = () => {\n    if (!disabled && !atLimit) {\n      inputRef.current?.click()\n    }\n  }\n\n  const handleInputChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n    if (e.target.files && e.target.files.length > 0) {\n      handleFiles(e.target.files)\n    }\n  }\n\n  return (\n    <div className={cn(\"flex flex-col gap-2\", className)}>\n      <input\n        ref={inputRef}\n        type=\"file\"\n        accept={accept}\n        multiple={mode === \"multiple\"}\n        disabled={disabled}\n        onChange={handleInputChange}\n        className=\"sr-only\"\n        tabIndex={-1}\n        aria-hidden=\"true\"\n      />\n\n      {variant === \"dropzone\" ? (\n        <DropzoneArea\n          accept={accept}\n          maxSize={maxSize}\n          disabled={disabled}\n          hasFiles={files.length > 0}\n          fileCount={files.length}\n          maxFiles={maxFiles}\n          onClick={openPicker}\n          onDrop={(fileList) => handleFiles(fileList)}\n        />\n      ) : (\n        <CompactTrigger\n          disabled={disabled}\n          atLimit={atLimit}\n          onClick={openPicker}\n        />\n      )}\n\n      {error && <ErrorMessage message={error} onDismiss={clearError} />}\n\n      {files.length > 0 &&\n        (variant === \"dropzone\" ? (\n          <div className=\"flex flex-col gap-1.5\">\n            {files.map((attachment, index) => (\n              <FileListItem\n                key={`${attachment.name}-${attachment.size}`}\n                attachment={attachment}\n                onRemove={() => handleRemove(index)}\n                disabled={disabled}\n              />\n            ))}\n          </div>\n        ) : (\n          <div className=\"flex flex-wrap gap-1.5\">\n            {files.map((attachment, index) => (\n              <CompactFileChip\n                key={`${attachment.name}-${attachment.size}`}\n                attachment={attachment}\n                onRemove={() => handleRemove(index)}\n                disabled={disabled}\n              />\n            ))}\n          </div>\n        ))}\n    </div>\n  )\n}\n\nexport { AttachmentInput }\n",
      "type": "registry:ui"
    }
  ],
  "type": "registry:ui"
}